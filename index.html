<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö (‡∏™‡πà‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md p-6 mt-4">
        <h2 class="text-2xl font-bold mb-4 text-center text-blue-600">‚òÅÔ∏è ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏•‡∏á Google Drive</h2>

        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</label>
            <input type="file" id="fileInput" accept="image/*" multiple class="w-full px-3 py-2 border rounded-lg">
        </div>

        <button id="uploadBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
            üì§ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
        </button>
        <p id="statusText" class="text-center mt-3 text-sm text-gray-500"></p>
    </div>

    <script>
        const myLiffId = "2009260001-eJBgSAYH"; 
        const n8nWebhookUrl = "https://laptop-tp9h962b.tail1bd7aa.ts.net/webhook/line-webhook";

        async function main() {
            await liff.init({ liffId: myLiffId });
            if (!liff.isLoggedIn()) { liff.login(); }
        }
        main();

        document.getElementById("uploadBtn").addEventListener("click", async () => {
            const fileInput = document.getElementById("fileInput");
            const files = fileInput.files;
            
            if(files.length === 0) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!");
                return;
            }
            
            const btn = document.getElementById("uploadBtn");
            const status = document.getElementById("statusText");
            btn.disabled = true;
            
            let successCount = 0;

            // üö® ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ 2: ‡∏ß‡∏ô Loop ‡∏™‡πà‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏π‡∏õ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ n8n ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÜ ‡πÑ‡∏õ
            for (let i = 0; i < files.length; i++) {
                btn.innerText = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${i + 1}/${files.length}...`;
                
                const formData = new FormData();
                formData.append("data", files[i]); // ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏≠‡∏ö Loop

                try {
                    const response = await fetch(n8nWebhookUrl, {
                        method: "POST",
                        body: formData
                    });

                    if(response.ok) {
                        successCount++;
                    }
                } catch (error) {
                    console.error("Error uploading file:", files[i].name);
                }
            }

            if(successCount === files.length) {
                alert(`‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á ${successCount} ‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö!`);
            } else {
                alert(`‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏à‡∏≤‡∏Å ${files.length} ‡∏£‡∏π‡∏õ (‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö)`);
            }

            btn.innerText = "üì§ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î";
            btn.disabled = false;
            fileInput.value = ""; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
        });
    </script>
</body>
</html>

